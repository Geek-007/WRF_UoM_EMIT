# WRF_UoM_EMIT

WRF_UoM_EMIT is an NCL based pre-processing script, for generating anthropogenic emissions files for use with WRF-Chem. It does not map emissions onto the model grid - this can be done using anthro_emis, or similar tools (which this tool will complement, rather than replace) - instead it is intended to be used for applying temporal and spatial variations to the emission data, mapping VOC emissions into chemical-scheme specific groupings, and combining emissions sectors into single emission variables.

This project is licensed under the terms of the GNU General Public License v3.0, as is provided with this repository.

## Table of Contents
1. [Overview](#Overview)
1. [Dependencies](#Dependencies)
2. [Inputs](#Inputs)
3. [Outputs](#Outputs)
4. [Run-time Options](#Run-time-Options)
5. [Methodology](#Methodology)
   1. [Diurnal Cycle](#Diurnal-cycle) 
   2. [Mapping VOC emissions](#VOC-mapping)
6. [Contributing](#contributing)

## Overview<a name="Overview"></a>

The tool scripts are contained in the ``Processing_Scripts`` directory, while example source file headers are provided in the ``emission_source_files_example`` directory. The principal tool script is ``MAIN_emission_processing.ncl``. At the head of this script you can set the run-time options controlling the process of emission generation, the rest of the script organises the calling of the processing functions (in scripts ``diurnal_cycle_routines.ncl``, ``preprocess_emissions_routines.ncl``, ``speciating_emissions_routines.ncl``, and ``vertical_distribution_routines.ncl``). Settings for the different input and output schemes, and data for the different processing options, are stored in a variety of files ending ``*data.ncl``


## Dependencies<a name="Dependencies"></a>

WRF_UoM_EMIT has been written in NCL (https://www.ncl.ucar.edu/); it has been tested with version 6.3.0. Input files are generated using anthro_emis (https://www2.acom.ucar.edu/wrf-chem/wrf-chem-tools-community); example configuration scripts for using this tool with EDGAR-HTAP emissions datasets are available in this repository: https://github.com/douglowe/PROMOTE-emissions .

## Inputs<a name="Inputs"></a>

WRF_UoM_EMIT takes two sets of input files. The first are general emission variables, the second are the NMVOC emission variables. 

The general emission variables should be in input files with the following naming convention:
wrfchemi\_[HH]z\_[domain]\_[YYYY]\_[MM]

The NMVOC emission variables should be in input files with the following naming convention:
wrfchemi\_[HH]z\_NMVOC\_[domain]\_[YYYY]\_[MM]

[HH] will be the hour of day (either 00 or 12 - as generated by anthro_emis using option **XX**). [domain] will be the model domain (d01, d02, etc), [YYYY] will be a 4-digit year, and [MM] will be a 2 digit month.

The standard input datasets supported are:
* EDGAR-HTAP
* SAFAR

The NMVOC input datasets supported are:
* MACCity
* EDGAR v4.3.2

These lists will be amended as more options are added.

## Outputs<a name="Outputs"></a>

WRF_UoM_EMIT creates a single set of input files, containing WRF-Chem emission scheme specific inputs. The naming convention followed is the same as that for the input files: `wrfchemi_[HH]z_[domain]_[YYYY]_[MM]`.

The WRF-Chem input schemes that are supported are:
* `cbmz_mos_orig`:
  * Emissions for CBM-Z gas-phase, and MOSAIC aerosol, schemes
  * WRF-Chem namelist options: `emiss_opt = 4` (ecbmz_mosaic) and `emiss_inpt_opt = 101` (emiss_inpt_pnnl_cm)
  * config option: `wrfchem_scheme = "cbmz_mos_orig"`
* `cri_mos_edgar_htap`:
  * Emissions for CRIv2R5 gas-phase, and MOSAIC aerosol, schemes
  * WRF-Chem namelist options: `emiss_opt = 20` (ecrimechtno) and `emiss_inpt_opt = 121` (emiss_inpt_tno)
  * config option: `wrfchem_scheme = "cri_mos_edgar_htap"`
* `cbmz_mos_htap`:
  * Emissions for CBM-Z gas-phase, and MOSAIC aerosol, schemes
  * only usable with WRF-Chem code inluding local UoM modifications - ask for more information 
  * WRF-Chem namelist options: `emiss_opt = 25` (ecbmz_mos_htap) and `emiss_inpt_opt = 122` (emiss_inpt_htap)
  * config option: `wrfchem_scheme = "cbmz_mos_htap"`


This list will be amended as more options are added.

## Run-time Options<a name="Run-time-Options"></a>

* Time and domain controls:
  * `month`: single string value (2 digits long)
  * `year`: single string value (4 digits long)
  * `domains`: array of string identifiers for domains to be processed (of style "dNN")
* Chemical scaling factors:
  * `nox_frac`: fraction of NOx emissions which are NO (real value between 0-1)
  * `oc_om_scale`: scaling factor for calculating organic matter (OM) emitted mass from the input organic carbon (OC) emitted mass 
* Input scheme controls:
  * `input_scheme`: identifier string for the emission dataset used
  * `nmvoc_scheme`: identifier string for the speciated NMVOC emission dataset used
    * `nmvoc_scheme@method`: controls how the NMVOC emissions are used
      * `direct`: create emissions directly from the NMVOC dataset
      * `fraction`: use the NMVOC dataset to speciate lumped NMVOC variables in the main emission dataset
* Output scheme control:
  * `wrfchem_scheme`: identifier string for the emission scheme generated, see [Outputs](#Outputs)
* Diurnal cycle controls:
  * `UTC_offset`: logical controller, to determine if local offsets from UTC should be calculated or not
    * `UTC_offset@method`: controls how the offset is calculated
      * `fixed`: use a single fixed offset from UTC, defined in this script
      * `timezones`: use timezone information to calculate the offset from UTC
    * `UTC_offset@fixed_offset`: offset from UTC for fixed method
    * `UTC_offset@daylightsaving`: logical controller, to determine if local daylight saving shifts need to be included in the UTC offset calculation
* Process logical controllers:
  * `STEP1_create_diurnal_cycle_and_prescaling`
  * `regional_modification_of_emissions`
  * `STEP2_apply_vertical_power_emissions`
  * `use_vertical_power_emission_files`
  * `STEP3_create_emissions_for_WRF_Chem`
* Regional modification of emissions:
  * `regional_modification_of_emissions@latitude_limits`
  * `regional_modification_of_emissions@longitude_limits`
  * `regional_modification_of_emissions@vars_mask`
  * `regional_modification_of_emissions@vars_scale`


## Methodology<a name="Methodology"></a>


### Diurnal Cycle<a name="Diurnal-cycle"></a>

### Mapping VOC emissions<a name="VOC-mapping"></a>


## Contributing<a name="Contributing"></a>


